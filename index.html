<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="title">Day Trade NASDAQ 100</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f7fa; color: #333; }
    .container { max-width: 1200px; margin: auto; padding: 20px; }
    .stock-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .stock-table th, .stock-table td { padding: 10px; border: 1px solid #ccc; text-align: left; }
    .green { color: green; }
    .red { color: red; }
    .favorite { background: #fffbe6; }
    #search { margin-bottom: 10px; padding: 8px; width: 100%; max-width: 300px; }
    #graph-container { margin-top: 30px; }
    #lang-toggle { float: right; margin-top: -50px; }
    #price-data { margin-bottom: 20px; }
    #price-data div { margin-bottom: 5px; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h1 data-i18n="header">Day Trade NASDAQ 100</h1>
    <select id="lang-toggle" onchange="switchLanguage(this.value)">
      <option value="pt-BR">ðŸ‡§ðŸ‡· PortuguÃªs</option>
      <option value="en">ðŸ‡ºðŸ‡¸ English</option>
    </select>
    <div id="price-data">
      <div id="nasdaq-price"></div>
      <div id="nasdaq-change"></div>
      <div id="daily-range"></div>
    </div>
    <input type="text" id="search" placeholder="Buscar ticker..." onkeyup="filterStocks()" data-i18n-placeholder="search">
    <table class="stock-table" id="nasdaq-stocks">
      <thead>
        <tr><th data-i18n="ticker">Ticker</th><th data-i18n="price">PreÃ§o</th><th data-i18n="premarket">PrÃ©-Mercado</th><th data-i18n="action">AÃ§Ã£o</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="graph-container"></div>
  </div>
  <script>
    const finnhubKey = 'd0qc619r01qt60ong100d0qc619r01qt60ong10g';
    const nasdaqStocks = [
      'AAPL', 'MSFT', 'GOOGL', 'AMZN', 'META', 'TSLA', 'NVDA', 'ADBE', 'INTC', 'NFLX',
      'CSCO', 'PEP', 'AVGO', 'COST', 'TXN', 'QCOM', 'AMAT', 'SBUX', 'AMD', 'PYPL'
    ];
    let favorites = new Set(JSON.parse(localStorage.getItem('favorites') || '[]'));
    let lang = localStorage.getItem('lang') || 'pt-BR';

    const translations = {
      'pt-BR': {
        title: 'Day Trade NASDAQ 100', header: 'Day Trade NASDAQ 100',
        ticker: 'Ticker', price: 'PreÃ§o', premarket: 'PrÃ©-Mercado', action: 'AÃ§Ã£o',
        search: 'Buscar ticker...'
      },
      'en': {
        title: 'Day Trade NASDAQ 100', header: 'Day Trade NASDAQ 100',
        ticker: 'Ticker', price: 'Price', premarket: 'Pre-Market', action: 'Action',
        search: 'Search ticker...'
      }
    };

    function updatePrice() {
      fetch(`https://finnhub.io/api/v1/quote?symbol=QQQ&token=${finnhubKey}`)
        .then(res => res.json())
        .then(data => {
          if (data.c && data.h && data.l && data.pc) {
            const preco = `$${data.c.toFixed(2)}`;
            const changePercent = (((data.c - data.pc) / data.pc) * 100).toFixed(2);
            document.getElementById('nasdaq-price').innerText = `PreÃ§o QQQ: ${preco}`;
            document.getElementById('nasdaq-change').innerText = `VariaÃ§Ã£o: ${changePercent}%`;
            document.getElementById('nasdaq-change').style.color = changePercent >= 0 ? 'green' : 'red';
            document.getElementById('daily-range').innerText = `Faixa diÃ¡ria: ${data.l.toFixed(2)} - ${data.h.toFixed(2)}`;
          }
        });
    }

    function updateStocks() {
      const table = document.querySelector('#nasdaq-stocks tbody');
      const rows = [];
      let requests = nasdaqStocks.map(symbol => {
        return fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${finnhubKey}`)
          .then(res => res.json())
          .then(data => {
            if (!data || !data.c || !data.pc) return;
            const preco = `$${data.c.toFixed(2)}`;
            const preMarket = data.pm ? `$${data.pm.toFixed(2)}` : 'N/D';
            const change = ((data.c - data.pc) / data.pc) * 100;
            rows.push({ symbol, preco, preMarket, change });
          });
      });
      Promise.all(requests).then(() => {
        rows.sort((a, b) => b.change - a.change);
        table.innerHTML = rows.map(row => {
          const color = row.change >= 0 ? 'green' : 'red';
          const fav = favorites.has(row.symbol) ? 'favorite' : '';
          return `<tr class="${fav}" data-symbol="${row.symbol}">
            <td><a href="#" onclick="showGraph('${row.symbol}')">${row.symbol}</a></td>
            <td class="${color}">${row.preco} (${row.change.toFixed(2)}%)</td>
            <td>${row.preMarket}</td>
            <td><button onclick="toggleFavorite('${row.symbol}')">${favorites.has(row.symbol) ? 'â˜…' : 'â˜†'}</button></td>
          </tr>`;
        }).join('');
      });
    }

    function toggleFavorite(symbol) {
      if (favorites.has(symbol)) {
        favorites.delete(symbol);
      } else {
        favorites.add(symbol);
      }
      localStorage.setItem('favorites', JSON.stringify([...favorites]));
      updateStocks();
    }

    function filterStocks() {
      const filter = document.getElementById('search').value.toUpperCase();
      const rows = document.querySelectorAll('#nasdaq-stocks tbody tr');
      rows.forEach(row => {
        const symbol = row.getAttribute('data-symbol');
        row.style.display = symbol.toUpperCase().includes(filter) ? '' : 'none';
      });
    }

    function showGraph(symbol) {
      const graphDiv = document.getElementById('graph-container');
      graphDiv.innerHTML = `<h3>GrÃ¡fico em Tempo Real - ${symbol}</h3>
        <iframe src="https://s.tradingview.com/widgetembed/?frameElementId=tradingview_${symbol}&symbol=NASDAQ%3A${symbol}&interval=1&symboledit=1&saveimage=1&toolbarbg=f1f3f6&studies=[]&theme=light&style=1&timezone=exchange&withdateranges=1&hide_side_toolbar=0&allow_symbol_change=1&details=1&hotlist=1&calendar=1&locale=${lang}" 
          width="100%" height="500" frameborder="0" allowtransparency="true"></iframe>`;
    }

    function switchLanguage(selectedLang) {
      lang = selectedLang;
      localStorage.setItem('lang', lang);
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang][key]) el.innerText = translations[lang][key];
      });
      const searchInput = document.getElementById('search');
      if (translations[lang]['search']) searchInput.placeholder = translations[lang]['search'];
      updatePrice();
      updateStocks();
    }

    document.addEventListener('DOMContentLoaded', () => {
      switchLanguage(lang);
      document.getElementById('lang-toggle').value = lang;
    });

    updatePrice();
    updateStocks();
    setInterval(updatePrice, 5000);
    setInterval(updateStocks, 5000);
  </script>
</body>
</html>
